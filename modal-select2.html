<!DOCTYPE html>
<html>
  <head>
    <title>Modal Select Input Fail</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  </head>

  <body>
    <div class="container mt-4">
      <select id="test-just-works">
        <option></option>
        <option value="1">Works on plain page</option>
        <option value="2">Fails in modal</option>
        <option value="3">Option asa</option>
        <option value="4">Optio n</option>
        <option value="5">Option fdf</option>
        <option value="6">Option qwe</option>
        <option value="7">Option rty</option>
        <option value="8">Option ghj</option>
        <option value="9">Option few</option>
      </select>
      <button class="btn btn-primary mt-4" id="test-button">Open modal</button>
    </div>
    <div class="modal" tabindex="-1" id="test-modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
            <div id="lipsum">
              <p>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam ac sodales mauris. Nullam blandit turpis in magna sagittis, quis lacinia lectus hendrerit. Maecenas sed vulputate ex. Vivamus dictum arcu id mauris iaculis, sed rutrum tortor volutpat. Vivamus imperdiet vulputate neque. Phasellus malesuada a urna non maximus. Sed quis nunc aliquam erat faucibus gravida. Maecenas ut erat laoreet ipsum molestie pellentesque. Nunc ut est ornare, bibendum leo vitae, vehicula risus. Maecenas sed nibh ut elit posuere imperdiet. Pellentesque purus turpis, vulputate ac vehicula eget, auctor quis lectus. Vestibulum laoreet, neque eu bibendum blandit, purus lorem porta velit, et ultricies mi nunc et nulla. Sed quis accumsan lacus, id accumsan diam.
              </p>
            </div>
            <select id="test-select">
              <option></option>
              <option value="1">Works on plain page</option>
              <option value="2">Fails in modal</option>
              <option value="3">Option asa</option>
              <option value="4">Optio n</option>
              <option value="5">Option fdf</option>
              <option value="6">Option qwe</option>
              <option value="7">Option rty</option>
              <option value="8">Option ghj</option>
              <option value="9">Option few</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      $('#test-just-works').select2({
        width: "100%",
        placeholder: "This works"
      });

      $("#test-button").click(function(){
        $('#test-modal')
          .on('shown.bs.modal', function(e) {
            $('#test-select').select2({
              width: "100%",
              placeholder: "This stops working if focus is lost"
            });
          })
          .modal({
            backdrop: 'static',
            keyboard: false
          });
      });
    </script>
  </body>
</html>
